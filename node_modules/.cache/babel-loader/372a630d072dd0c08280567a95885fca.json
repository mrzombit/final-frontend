{"ast":null,"code":"var isDigit = require('../tokenizer').isDigit;\nvar cmpChar = require('../tokenizer').cmpChar;\nvar TYPE = require('../tokenizer').TYPE;\nvar DELIM = TYPE.Delim;\nvar WHITESPACE = TYPE.WhiteSpace;\nvar COMMENT = TYPE.Comment;\nvar IDENT = TYPE.Ident;\nvar NUMBER = TYPE.Number;\nvar DIMENSION = TYPE.Dimension;\nvar PLUSSIGN = 0x002B; // U+002B PLUS SIGN (+)\nvar HYPHENMINUS = 0x002D; // U+002D HYPHEN-MINUS (-)\nvar N = 0x006E; // U+006E LATIN SMALL LETTER N (n)\nvar DISALLOW_SIGN = true;\nvar ALLOW_SIGN = false;\nfunction isDelim(token, code) {\n  return token !== null && token.type === DELIM && token.value.charCodeAt(0) === code;\n}\nfunction skipSC(token, offset, getNextToken) {\n  while (token !== null && (token.type === WHITESPACE || token.type === COMMENT)) {\n    token = getNextToken(++offset);\n  }\n  return offset;\n}\nfunction checkInteger(token, valueOffset, disallowSign, offset) {\n  if (!token) {\n    return 0;\n  }\n  var code = token.value.charCodeAt(valueOffset);\n  if (code === PLUSSIGN || code === HYPHENMINUS) {\n    if (disallowSign) {\n      // Number sign is not allowed\n      return 0;\n    }\n    valueOffset++;\n  }\n  for (; valueOffset < token.value.length; valueOffset++) {\n    if (!isDigit(token.value.charCodeAt(valueOffset))) {\n      // Integer is expected\n      return 0;\n    }\n  }\n  return offset + 1;\n}\n\n// ... <signed-integer>\n// ... ['+' | '-'] <signless-integer>\nfunction consumeB(token, offset_, getNextToken) {\n  var sign = false;\n  var offset = skipSC(token, offset_, getNextToken);\n  token = getNextToken(offset);\n  if (token === null) {\n    return offset_;\n  }\n  if (token.type !== NUMBER) {\n    if (isDelim(token, PLUSSIGN) || isDelim(token, HYPHENMINUS)) {\n      sign = true;\n      offset = skipSC(getNextToken(++offset), offset, getNextToken);\n      token = getNextToken(offset);\n      if (token === null && token.type !== NUMBER) {\n        return 0;\n      }\n    } else {\n      return offset_;\n    }\n  }\n  if (!sign) {\n    var code = token.value.charCodeAt(0);\n    if (code !== PLUSSIGN && code !== HYPHENMINUS) {\n      // Number sign is expected\n      return 0;\n    }\n  }\n  return checkInteger(token, sign ? 0 : 1, sign, offset);\n}\n\n// An+B microsyntax https://www.w3.org/TR/css-syntax-3/#anb\nmodule.exports = function anPlusB(token, getNextToken) {\n  /* eslint-disable brace-style*/\n  var offset = 0;\n  if (!token) {\n    return 0;\n  }\n\n  // <integer>\n  if (token.type === NUMBER) {\n    return checkInteger(token, 0, ALLOW_SIGN, offset); // b\n  }\n\n  // -n\n  // -n <signed-integer>\n  // -n ['+' | '-'] <signless-integer>\n  // -n- <signless-integer>\n  // <dashndashdigit-ident>\n  else if (token.type === IDENT && token.value.charCodeAt(0) === HYPHENMINUS) {\n    // expect 1st char is N\n    if (!cmpChar(token.value, 1, N)) {\n      return 0;\n    }\n    switch (token.value.length) {\n      // -n\n      // -n <signed-integer>\n      // -n ['+' | '-'] <signless-integer>\n      case 2:\n        return consumeB(getNextToken(++offset), offset, getNextToken);\n\n      // -n- <signless-integer>\n      case 3:\n        if (token.value.charCodeAt(2) !== HYPHENMINUS) {\n          return 0;\n        }\n        offset = skipSC(getNextToken(++offset), offset, getNextToken);\n        token = getNextToken(offset);\n        return checkInteger(token, 0, DISALLOW_SIGN, offset);\n\n      // <dashndashdigit-ident>\n      default:\n        if (token.value.charCodeAt(2) !== HYPHENMINUS) {\n          return 0;\n        }\n        return checkInteger(token, 3, DISALLOW_SIGN, offset);\n    }\n  }\n\n  // '+'? n\n  // '+'? n <signed-integer>\n  // '+'? n ['+' | '-'] <signless-integer>\n  // '+'? n- <signless-integer>\n  // '+'? <ndashdigit-ident>\n  else if (token.type === IDENT || isDelim(token, PLUSSIGN) && getNextToken(offset + 1).type === IDENT) {\n    // just ignore a plus\n    if (token.type !== IDENT) {\n      token = getNextToken(++offset);\n    }\n    if (token === null || !cmpChar(token.value, 0, N)) {\n      return 0;\n    }\n    switch (token.value.length) {\n      // '+'? n\n      // '+'? n <signed-integer>\n      // '+'? n ['+' | '-'] <signless-integer>\n      case 1:\n        return consumeB(getNextToken(++offset), offset, getNextToken);\n\n      // '+'? n- <signless-integer>\n      case 2:\n        if (token.value.charCodeAt(1) !== HYPHENMINUS) {\n          return 0;\n        }\n        offset = skipSC(getNextToken(++offset), offset, getNextToken);\n        token = getNextToken(offset);\n        return checkInteger(token, 0, DISALLOW_SIGN, offset);\n\n      // '+'? <ndashdigit-ident>\n      default:\n        if (token.value.charCodeAt(1) !== HYPHENMINUS) {\n          return 0;\n        }\n        return checkInteger(token, 2, DISALLOW_SIGN, offset);\n    }\n  }\n\n  // <ndashdigit-dimension>\n  // <ndash-dimension> <signless-integer>\n  // <n-dimension>\n  // <n-dimension> <signed-integer>\n  // <n-dimension> ['+' | '-'] <signless-integer>\n  else if (token.type === DIMENSION) {\n    var code = token.value.charCodeAt(0);\n    var sign = code === PLUSSIGN || code === HYPHENMINUS ? 1 : 0;\n    for (var i = sign; i < token.value.length; i++) {\n      if (!isDigit(token.value.charCodeAt(i))) {\n        break;\n      }\n    }\n    if (i === sign) {\n      // Integer is expected\n      return 0;\n    }\n    if (!cmpChar(token.value, i, N)) {\n      return 0;\n    }\n\n    // <n-dimension>\n    // <n-dimension> <signed-integer>\n    // <n-dimension> ['+' | '-'] <signless-integer>\n    if (i + 1 === token.value.length) {\n      return consumeB(getNextToken(++offset), offset, getNextToken);\n    } else {\n      if (token.value.charCodeAt(i + 1) !== HYPHENMINUS) {\n        return 0;\n      }\n\n      // <ndash-dimension> <signless-integer>\n      if (i + 2 === token.value.length) {\n        offset = skipSC(getNextToken(++offset), offset, getNextToken);\n        token = getNextToken(offset);\n        return checkInteger(token, 0, DISALLOW_SIGN, offset);\n      }\n      // <ndashdigit-dimension>\n      else {\n        return checkInteger(token, i + 2, DISALLOW_SIGN, offset);\n      }\n    }\n  }\n  return 0;\n};","map":null,"metadata":{},"sourceType":"script"}