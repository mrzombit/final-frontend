{"ast":null,"code":"var SourceMapGenerator = require('source-map/lib/source-map-generator').SourceMapGenerator;\nvar trackNodes = {\n  Atrule: true,\n  Selector: true,\n  Declaration: true\n};\nmodule.exports = function generateSourceMap(handlers) {\n  var map = new SourceMapGenerator();\n  var line = 1;\n  var column = 0;\n  var generated = {\n    line: 1,\n    column: 0\n  };\n  var original = {\n    line: 0,\n    // should be zero to add first mapping\n    column: 0\n  };\n  var sourceMappingActive = false;\n  var activatedGenerated = {\n    line: 1,\n    column: 0\n  };\n  var activatedMapping = {\n    generated: activatedGenerated\n  };\n  var handlersNode = handlers.node;\n  handlers.node = function (node) {\n    if (node.loc && node.loc.start && trackNodes.hasOwnProperty(node.type)) {\n      var nodeLine = node.loc.start.line;\n      var nodeColumn = node.loc.start.column - 1;\n      if (original.line !== nodeLine || original.column !== nodeColumn) {\n        original.line = nodeLine;\n        original.column = nodeColumn;\n        generated.line = line;\n        generated.column = column;\n        if (sourceMappingActive) {\n          sourceMappingActive = false;\n          if (generated.line !== activatedGenerated.line || generated.column !== activatedGenerated.column) {\n            map.addMapping(activatedMapping);\n          }\n        }\n        sourceMappingActive = true;\n        map.addMapping({\n          source: node.loc.source,\n          original: original,\n          generated: generated\n        });\n      }\n    }\n    handlersNode.call(this, node);\n    if (sourceMappingActive && trackNodes.hasOwnProperty(node.type)) {\n      activatedGenerated.line = line;\n      activatedGenerated.column = column;\n    }\n  };\n  var handlersChunk = handlers.chunk;\n  handlers.chunk = function (chunk) {\n    for (var i = 0; i < chunk.length; i++) {\n      if (chunk.charCodeAt(i) === 10) {\n        // \\n\n        line++;\n        column = 0;\n      } else {\n        column++;\n      }\n    }\n    handlersChunk(chunk);\n  };\n  var handlersResult = handlers.result;\n  handlers.result = function () {\n    if (sourceMappingActive) {\n      map.addMapping(activatedMapping);\n    }\n    return {\n      css: handlersResult(),\n      map: map\n    };\n  };\n  return handlers;\n};","map":null,"metadata":{},"sourceType":"script"}